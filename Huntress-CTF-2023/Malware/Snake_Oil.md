# Snake Oil

### Challenge Description
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/3cc9baa5-f81b-409a-9ceb-f6b892900fe4)

### Solution
The provided file is an executable:  
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/e3b06cff-dfae-410b-b4eb-753fa7aaa299)

However, running strings on it, we can see it's a Python compiled binary:  
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/541a74ca-b11d-4ea1-9eaf-c63b0a437ea6)

I also found a part of the flag reversed:  
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/bc536fed-17c7-4af6-b523-1af4b59b5845)
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/aff129cb-9dfd-423e-9617-44e3898c1599)

So the flag is definitely within the binary. We first use the [pyinstxtractor](https://github.com/extremecoders-re/pyinstxtractor) tool to extract it:

```bash
python3 pyinstxtractor.py snake_oil.exe
```

After we get the decompiled code, we find a file called `brain-melt.pyc` which we can decompile with the [pycdc](https://github.com/zrax/pycdc) tool:

![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/e8ae0fcd-1a15-4fff-af10-770bd455efa8)

We can see a `decrypt` and `deobfuscate` function which contains the 3 parts of the flag. When we try to run the script we have an incorrect syntax on the lambda which ChatGPT very helpfully corrects for us:  
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/6513dd9a-3e82-4e51-b72c-1e7da353fbc3)

Now we have this script we can run to get the flag:

```python3
import base64

def decrypt(s1, s2):
    return ''.join([chr(ord(c1) ^ ord(c2)) for c1, c2 in zip(s1, s2)])


def deobfuscate():
    part1 = '2ec7627d{galf'[::-1]
    part2 = str(base64.b64decode('NjIwM2I1Y2M2OWY0'.encode('ascii')), 'UTF8')
    part3 = decrypt('\x17*\x07`BC\x14*R@\x14^*', 'uKeVuzwIexplW')
    key = part1 + part2 + part3
    return key

print(deobfuscate())
```
![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/5b318aaa-0c4b-49f8-8eab-5f07a5a2148c)

flag{d7267ce26203b5cc69f4bab679cc78d2}

